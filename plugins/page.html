<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />

		<link href="css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="css/reset.css" />
		<style type="text/css">
			html {
				background-color: #FFFFFF;
			}
			body {
				padding: 1px;
				position: relative;
				background-color: #FFFFFF;
			}
			
			body>div {
				border: 2px solid black;
				border-radius: 5px;
				box-shadow: 0 0 5px grey;
			}
			
			#header {
				height: 8%;
				display: flex;
				font-size: 1rem;
				background-color: #F0F0F0;
			}
			
			#header>div:nth-child(1) {
				flex: 2;
				text-align: center;
			}
			
			#header>div:nth-child(2) {
				flex: 5;
				text-align: center;
				border-right: 2px solid black;
			}
			
			#header>div:nth-child(3) {
				flex: 1;
				text-align: center;
			}
			
			#header>div:nth-child(1)>span {
				display: block;
				float: left;
				width: 50%;
				height: 100%;
				border-right: 2px solid black;
			}
			
			#header>div:nth-child(2)>div {
				font-size: 12px;
				height: 40%;
				line-height: 150%;
				padding-left: 20px;
				letter-spacing: 20px;
			}
			
			#header>div:nth-child(2)>ul {
				height: 60%;
				border-top: 1px solid black;
				background-color: #FAFAFA;
			}
			
			#header>div:nth-child(2)>ul>li {
				float: left;
				width: 25%;
				height: 100%;
				border-right: 1px solid black;
			}
			
			#header>div:nth-child(2)>ul>li:last-child {
				border-right: transparent;
			}
			
			#pageBody {}
			
			#pageBody>div>ul {
				height: 2rem;
				display: flex;
			}
			
			#pageBody>div>ul>li:first-child {
				flex: 2;
				text-align: center;
			}
			
			#pageBody>div>ul>li:nth-child(2) {
				flex: 5;
				text-align: center;
				border-right: 2px solid black;
			}
			
			#pageBody>div>ul>li:last-child {
				flex: 1;
				text-align: center;
				border-top: 1px solid black;
			}
			
			#pageBody>div>ul>li:first-child>span {
				display: block;
				width: 50%;
				float: left;
				border-top: 1px solid black;
				border-right: 2px solid black;
			}
			#pageBody>div>ul>li:first-child>span:first-child {
				background-color: #F0F0F0;
			}
			
			#pageBody>div>ul>li:nth-child(2)>span {
				display: block;
				width: 25%;
				float: left;
				border-top: 1px solid black;
				border-right: 1px solid black;
			}
			
			#pageBody>div>ul>li:nth-child(2)>span:last-child {
				border-right: transparent;
			}
			#pageBody>div>ul>li:last-child>span {
				display: block;
			}
			
			#pageBody>div>ul>li {
				height: 2rem;
				line-height: 2rem;
				font-size: 0.8rem;
				flex: 1;
				text-align: center;
			}
			
			#pageBody>div:nth-child(2)>ul>li:first-child {
				max-width: 0.2rem;
				background-color: black;
			}
			
			#pageBody>div:last-child>ul>li:last-child {}
			
			.mui-poppicker-header {
				display: none;
			}
			
			.mui-poppicker {
				width: 4rem;
				height: 10rem;
				transition: 0s;
				-webkit-transform: 0s;
			}
			
			.mui-poppicker-body {
				height: 10rem;
			}
			
			.mui-poppicker .mui-pciker-list {}
			
			.ishide {
				display: none;
			}
			
			.pickerDiv {
				width: 4rem;
				overflow: hidden;
				position: absolute;
				top: 300px;
				left: 0;
				border: 1px solid orange;
				background-color: paleturquoise;
				z-index: 999;
			}
			
			#cover {
				width: 100%;
				height: 100%;
				position: absolute;
				top: 0;
				left: 0;
				background-color: black;
				opacity: 0.2;
			}
			
			.pickerDiv>div>ul {
				padding: 2px;
				text-align: center;
			}
			
			.pickerDiv>div>ul>li {
				height: 2rem;
				line-height: 2rem;
				
				font-size: 0.7rem;
				border-bottom: 1px solid burlywood;
			}
			
			.pickerDiv>div>ul>li:last-child {
				border-bottom: transparent;
			}
			
			.detailsBox>div {
				position: relative;
			}
			
			.detailsBox>ul {
				height: 3rem;
				border-top: 1px solid black;
			}
			
			.detailsBox>ul>li {
				position: relative;
			}
			
			#dataList .detailsBox>ul {
				padding: 2px 0 2px 2rem;
				border-left: 1px solid black;
			}
			
			#gameList .detailsBox>ul {
				padding: 2px 0 2px 0;
			}
			
			#btnList .detailsBox>ul {
				padding: 2px 2px 2px 0;
				border-right: 1px solid black;
			}
			
			.detailsBox>ul>li {
				height: 50%;
			}
			
			.detailsBox>ul>li:first-child {
				/*border-bottom: 1px solid black;*/
			}
			
			.detailsBox .mui-badge {
				position: absolute;
				top: -2rem;
				left: 0.3rem;
			}
			
			.detailsBox>ul>li>input[type=text] {
				position: absolute;
				left: 2rem;
				display: inline;
				width: 220%;
				height: 1.3rem;
				margin: 0;
				z-index: 999;
				line-height: 1.3rem;
				padding: 0 0 0 5px;
				font-size: 1rem;
			}
			/*.detailsBox>ul>li:nth-child(1)>input[type=text] {
				top: 1px;
			}
			.detailsBox>ul>li:nth-child(2)>input[type=text] {
				top: 20px;
			}*/
		</style>
		<script src="js/template-web.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/html" id="list">
			<div id="dataList">
				<% if(num){ %>
				<% for(var i = 0; i < num; i++){ %>
				<ul>
					<li>
						<span class="userBox"><span class="mui-badge mui-badge-primary"><%= i+1 %></span></span>
						<span class="statusBox">身份</span>
					</li>
					<li>
						<span>-</span>
						<span>-</span>
						<span>-</span>
						<span>-</span>
					</li>
					<li>
						<span class="statusBox">-</span>
					</li>
				</ul>
				<% } %>
				<% } %>
			</div>
		</script>
		<script type="text/html" id="pickers">
			<ul>
				{{each roleList value i}}
				<li>{{value.text}}</li>
				{{/each}}
			</ul>
		</script>
		<script type="text/html" id="userPickers">
			<ul>
				<% if(num){ %>
				<% for(var k = 0; k < num; k++){ %>
				<li>
					<%= k+1%>
				</li>
				<% } %>
				<% } %>
			</ul>
		</script>
	</head>

	<body>
		<div>
			<div id="header">
				<div>
					<span>玩家序号</span>
					<span>自认身份</span>
				</div>
				<div>
					<div>投票结果</div>
					<ul>
						<li>1轮</li>
						<li>2轮</li>
						<li>3轮</li>
						<li>4轮</li>
					</ul>
				</div>
				<div>
					<span>评估身份</span>
				</div>
			</div>
			<div id="pageBody">

			</div>
			<div id="cover" class="ishide"></div>
			<div class="pickerDiv ishide" id="pickerDiv">
				<div id="picker">

				</div>
			</div>
			<div class="pickerDiv ishide" id="userPickerDiv">
				<div id="userPicker">

				</div>
			</div>
			<div id="txtBox">

			</div>
		</div>

		<script src="js/mui.min.js"></script>
		<script src="js/zepto.min.js"></script>
		<script src="js/fx.js"></script>
		<script type="text/javascript">
			mui.init();
		</script>
		<script type="text/javascript">
			var data;
			data = initData();
			userList(data);
			pickerList(data);
			userPicker(data);
			userBtn();

			//玩家按钮功能
			function userBtn() {
				var ele, pickers, userPickers;
				pickers = $('#pickerDiv');
				userPickers = $('#userPickerDiv');
				$('#dataList>ul>li>.statusBox').on('tap', function(e) {
					var set = seat(e);
					ele = null;
					ele = this;
					picker(set, pickers);
				});
				$('#dataList>ul>li:first-child').off();
				$('#btnList>ul>li:last-child').on('tap', function(e) {
					var set = seat(e);
					ele = null;
					ele = this;
					picker(set, pickers);
				});
				$('.pickerDiv>div>ul>li').on('tap', function(e) {
					var picker = $('.pickerDiv');
					var text = e.target.innerHTML;
					$(ele).html(text);
					picker.css({
						display: 'none'
					});
					$('#cover').addClass('ishide');
				});
				$('#cover').on('tap', function(e) {
					$('.pickerDiv').css({
						display: 'none'
					});
					$(this).addClass('ishide');
				})
				$('#dataList>ul>li:nth-child(2)>span').on('tap', function(e) {
					var set = seat(e);
					ele = null;
					ele = this;
					picker(set, userPickers);
				})
			}
			//位置
			function seat(e) {
				var set, target;
				set = {};
				target = e.target;
				set.mx = target.offsetLeft;
				set.my = target.offsetTop;
				set.width = target.offsetWidth;
				set.height = target.offsetHeight;
				set.clientWidth = target.offsetParent.clientWidth;
				set.clientHeight = target.offsetParent.clientHeight;
				return set;
			}
			//初始化数据
			function initData() {
				var data = JSON.parse(localStorage.getItem('pluginData'));
				var roleList = data.roleList;
				var arr = [];

				$.each(roleList, function(index, item) {
					var obj = {};
					obj.value = index + 1;
					obj.text = item;
					arr.push(obj);
				});
				data.roleList = arr;
				return data;
			}
			//生成选择器列表
			function pickerList(data) {
				var box = null;
				box = $('#picker');
				box.html('');
				var html = template("pickers", data);
				box.html(html);
			}

			function userPicker(data) {
				var box = null;
				box = $('#userPicker');
				box.html('');
				var html = template("userPickers", data);
				box.html(html);
			}
			//生成玩家列表
			function userList(data) {
				console.log(data);
				var box = null;
				box = $('#pageBody');
				box.html('');
				var html = template("list", data);
				box.html(html);
			}
			//选择器
			function picker(set, pickers) {
				var picker, pickerBoxX, pickerBoxY, pickerBoxWidth, pickerBoxHeight, cover;
				picker = pickers;
				cover = $('#cover');
				picker.css({
					display: 'block',
					opacity: '0'
				})
				cover.removeClass('ishide');
				pickerBoxWidth = picker.width();
				pickerBoxHeight = picker.height();
				console.log(pickerBoxWidth)
				pickerBoxX = (set.clientWidth - set.mx) < pickerBoxWidth ? (set.clientWidth - pickerBoxWidth) : set.mx;
				pickerBoxY = (set.my > pickerBoxHeight / 2) ? (set.my - pickerBoxHeight / 2) + set.height / 2 : 8;
				picker.css({
					top: pickerBoxY + 'px',
					left: pickerBoxX + 'px',
				});
				picker.animate({
					opacity: 1,
					scaleY: 1.1
				}, 120, 'ease-in');
			}
			box();
			//详情盒子
			function box() {
				var boxBtn = $('.boxShow');
				var box1, box2, box3;
				box1 = $('#dataList>.detailsBox');
				box2 = $('#gameList>.detailsBox');
				box3 = $('#btnList>.detailsBox');
				boxBtn.on('tap', function(e) {
					var index = $(this).attr('data-num');
					console.log(index);
					var txt = $(this).html();
					if(txt && txt == '展开') {
						$(this).html('收起')
					} else {
						$(this).html('展开')
					}
					$(box1[index]).toggleClass('ishide');
					$(box2[index]).toggleClass('ishide');
					$(box3[index]).toggleClass('ishide');
				})
			}
		</script>
	</body>

</html>